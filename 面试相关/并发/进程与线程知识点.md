# 进程和线程？

## 进程？

- 进程是程序的一次执行过程，是**系统运行程序的基本单位**，进程是动态的。
- 系统运行一个程序就是一个进程从创建，运行到消亡的过程。

Java中，**启动main函数的时候其实就是启动了一个JVM进程**，而main函数所在的线程就是这个进程的主线程。

## 线程？

线程是一个比进程**更小**的执行单位。

一个进程在其执行过程中产生多个线程，**同类的多线程共享进程的堆和方法区资源**，每个线程有自己的程序计数器，虚拟机栈和本地方法栈。

**系统在产生一个线程，或是各个线程之间切换工作时，负担比进程小得多**，因此线程也被称为轻量级进程。

Java程序天生就是多线程程序，可以通过JMX查看一下：

```java
public class Main {

    public static void main(String[] args) {
        // 获取 Java 线程管理 MXBean
        ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();
        // 不需要获取同步的 monitor 和 synchronizer 信息，仅获取线程和线程堆栈信息
        ThreadInfo[] threadInfos = threadMXBean.dumpAllThreads(false,false);
        // 遍历线程信息，仅打印线程 ID 和线程名称信息 和 线程状态
        for (ThreadInfo threadInfo : threadInfos) {
            System.out.println("[" + threadInfo.getThreadId() + "]" + threadInfo.getThreadName() + "->" + threadInfo.getThreadState());
        }
    }
    
}
```

输出结果如下：

```java
[6]Monitor Ctrl-Break->RUNNABLE //这是IDEA特有的监控线程
[5]Attach Listener->RUNNABLE //添加事件
[4]Signal Dispatcher->RUNNABLE  // 分发处理给 JVM 信号的线程
[3]Finalizer->WAITING    //清除 reference 线程
[2]Reference Handler->WAITING  //清除 reference 线程
[1]main->RUNNABLE //main线程，程序入口
```

> 一个Java程序得运行是main线程和多个线程同时运行。

## 协程？

> https://zhuanlan.zhihu.com/p/172471249

协程运行在线程之上，当一个协程执行完成后，可以选择主动让出，让另一个协程运行在当前线程之上。**协程并没有增加线程数量，只是在线程的基础之上通过分时复用的方式运行多个协程**，而且协程的切换在用户态完成，切换的代价比线程从用户态到内核态的代价小很多。

协程只有和异步IO结合起来，才能发挥最大的威力：假设协程运行在线程之上，并且协程调用了一个阻塞IO操作，这时候会发生什么？实际上操作系统并不知道协程的存在，它只知道线程，**因此在协程调用阻塞IO操作的时候，操作系统会让线程进入阻塞状态，当前的协程和其它绑定在该线程之上的协程都会陷入阻塞而得不到调度，这往往是不能接受的。**

在有大量IO操作业务的情况下，我们采用协程替换线程，可以到达很好的效果，一是降低了系统内存，二是减少了系统切换开销，因此系统的性能也会提升。

