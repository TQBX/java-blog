[toc]

本文摘自：《JavaGuide》

# redis简介

redis数据库，与传统数据库不同，redis的数据存储在内存中，读写速度非常快。

redis可以应用的方向：缓存，分布式锁，事务，持久化，LUA脚本，LRU驱动事件，多种集群方案。

# 为什么要用redis

高性能：

- 假设数据存储在数据库中，从中读取其实是从硬盘上读取的，读取速度相对较慢。
- 但将其存储在缓存中，再读取的时候，直接可以从缓存中获取，直接操作内存，速度很快。
- 如果数据库中的对应数据改变之后，需要同步改变缓存中响应的数据。

高并发：

- 直接操作缓存能够承受的请求远远大于直接访问数据库，所以可以把数据库中的部分数据转移到缓存中去，这样用户的一部分请求将会直接到缓存，而不经过数据库。

# 为什么不用map做缓存

缓存分为本地缓存和分布式缓存。

Map：

- 是本地缓存，轻量及快速，生命周期随jvm的销毁而结束。
- 在多实例的情况下，每个实例都需要保存一份缓存，缓存不具有一致性。

redis或memcached：

- 是分布式缓存，在多实例的情况下，各实例共用一份缓存，缓存具有一致性。
- 需要保持分布式缓存服务的高可用，整个程序架构上较为复杂。

# redis线程模型

[https://www.javazhiyin.com/22943.html](https://www.javazhiyin.com/22943.html)

redis内部使用文件事件处理器`filter event handler`，这个文件处理器是单线程的，因此redis被称为单线程的模型。

采用IO多路复用机制同时监听多个socket，根据socket上的事件来选择对应的事件处理器进行处理。

文件处理器的四部分：

- 多个socket
- IO多路复用程序
- 文件事件分派器
- 事件处理器（连接应答处理器，命令请求处理器，命令回复处理器）

多个socket可能会并发产生不同的操作，每个操作对应不同的文件事件，但是IO多路复用程序会监听多个socket，会将socket产生的事件放入队列中排队，事件分派器每次从队列中取出一个事件，把该事件交给对应的事件处理器进行处理。

# redis和memcached的区别

| 对比参数     | redis                                                        | Memecached                                                 |
| ------------ | ------------------------------------------------------------ | ---------------------------------------------------------- |
| 类型         | 1、支持内存<br />2、非关系型数据库                           | 1、支持内存<br />2、key-value键值对的形式<br />3、缓存系统 |
| 数据存储类型 | String、List、Set<br />Hash、SortSet（Zset）                 | 1、文本型<br />2、二进制类型                               |
| 操作类型     | 1、批量操作<br />2、事务支持（假事务）<br />3、每个类型不同的CRUD | 1、CRUD<br />2、少量的其他命令                             |
| 附加功能     | 1、发布订阅模式<br />2、主从分区<br />3、序列化支持<br />4、脚本支持（LUA脚本） | 多线程服务支持                                             |
| 网络IO模型   | 单线程模型                                                   | 多线程、非阻塞IO模式                                       |
| 事件库       | 自动简易事件库AeEvent                                        | 贵族血统的LibEvent事件库                                   |
| 持久化支持   | RDB、AOF                                                     | 不支持                                                     |

# redis常见数据结构以及使用场景分析

## String

常用操作：set、get、decr、incr、mget

String数据结构是简单的key-value类型，应用于常规的缓存应用：微博数、粉丝数等。

## Hash

常用操作：hget、hset、hgetall

String类型的field和value的映射表，hash适合用于存储对象，后续操作时，可以直接仅仅修改该对象中的某个字段的值。如：

```java
key=user122
value={
    "id": 1,
    "name":"summerday",
    "age":20
}
```

## List

常用操作：lpush、rpush、lpop、rpop、lrange

双向链表，可以支持双向查找遍历，可以实现消息列表，粉丝关注列表的，lrange命令可以实现从某个元素开始读取多少个元素，可以实现简单的高性能分页。

## Set

