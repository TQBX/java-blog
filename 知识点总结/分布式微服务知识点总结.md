[toc]

# 如何实现接口的幂等性

**什么是幂等？**

相同条件下对一个业务的操作，不管操作多少次，结果都是一样的。

1. **唯一id**，每次操作，都根据操作和内容生成唯一的id，在执行之前先判断id是否存在，如果不存在则执行后续操作，并保存到数据库或者redis。
2. 服务端提供发送**token**的接口，业务调用接口先获取token，调用业务接口请求时，把token携带过去，服务器判断token是否存在redis种，存在表示第一次请求，可以继续执行任务，执行业务完成后，最后需要把redis种的token删除。
3. 建**去重表**，将业务中有标识的字段保存到去重表，如果表中存在，则表示已经处理过了。
4. **版本控制**。增加版本号，当版本号符合时，才能更新数据。【乐观锁的概念】
5. **状态控制**。例如订单有状态已支付，未支付，支付中，支付失败，当处于未支付的时候才允许修改为支付中等。

# 分布式事务解决方案

